=Service Web WCF=
_par Narbonne Christophe_

==Choix du service web==
Le choix de mettre en place un service web c'est pris assez vite. Exposer une base de donnée nue si on veut une gestion fine des droits, ça a ses limites. Du fait que le sujet semblait encourager les technologies Microsoft, nous avons donc pris celles les plus à jour que l'on pouvais trouver.
	* .NET4
	* Visual Studio 2010
	* SQL Server 2008 R2
	* WPF
une fois ces briques en place il aurait été étonnant que le web service ne tire pas profit de *LINQ* et de *WCF*.

WCF (_*W* indows *C* omunication *F* ondation_) m'as permis d'exposer une API pour interfacer la base de donnée tant pour la lecture que pour l'écriture. L'intérêt est multiple, comme mentionné ça permet une gestion fine des droits mais ça permet aussi de pouvoir déporter le service sur un serveur distinct de la base de donnée et de réduire la part du code métier dans l'interface (avantageux si nous venions à en faire une seconde pour mobile par exemple).

==Echanges d'evenements==
Les évènements étant des objets échangés en quantité, et étant le coeur de l'application il paraissait important de les cadrer clairement, nous avons donc aggrégé la partie publique c'est à la partie qui interesse le client dans une classe avec le nombre de champs le plus mince nécessaire.

{{{

class EventData
{
	DateTime  Start;          // Date de début
	DateTime  End;           // Date de fin
	string    Name;         // Titre/nom de l'évènement
	string    Place;       // Lieu (utilisé pour la gestion des salles)
	string    Subject;    // Nom de la matière
	bool      Mandatory; // L'affichage est il Obligatoire?
	string    Type;     // Distanciel, Cours, sortie entre pote?
	string    Speaker; // Qui organise/gère l'évènement? (prof)
}

}}}
==Implémentation API==
Voilà la partie publique (au 26 avril 2010) du service.
Du fait que le développement soit en Français et que les noms des tables et champs en français, un mélange original se fait.

{{{

public interface IBusinessLayer
{

	#region Lecture d'évènements
		EventData[] getEventsByCampus(string CampusName, DateTime Start, DateTime Stop, DateTime LastUpdate);
		EventData[] getEventsByUniversity(DateTime Start, DateTime Stop, DateTime LastUpdate);
		EventData[] getEventsByPeriod(string PeriodName, DateTime Start, DateTime Stop, DateTime LastUpdate);
		EventData[] getEventsByClass(string ClassName, DateTime Start, DateTime Stop, DateTime LastUpdate);
		EventData[] getPrivateEvents(DateTime Start, DateTime Stop, DateTime LastUpdate);
	#endregion
	#region completion
		string[] getCampusNames();
		string[] getClassesNames();
		string[] getPromotionsNames();
		string[] getPeriodsNames();
		string[] getSubjectsNames();
		string[] getUsersNames();
	#endregion
	#region ecriture
		string addUser(string UserName, string UserPassword, string UserClassName);
		string addCampus(string CampusName);
		string addClass(string ClassName, string CampusName, string PeriodeName);
		string addPromotion(string PromotionName);
		string addSubject(string SubjectName, int Hours);
		string addPeriod(string PeriodName, string PromotionName, DateTime PeriodStart, DateTime PeriodEnd);
		string grantNewRight(string UserName, int Type, string CampusName);
		string addEvent(string EventName, DateTime Start, DateTime End, bool Mandatory, string SpeakerName, string CampusName, string PeriodName, string SubjectName, string Type, string Place);
	#endregion
}

}}}

Pour comprendre la teneur des objets en jeux, je vous recommande de vous référer à [database la partie traitant de la DB]

 * _*Note:* Les extrémums de DateTime en SQLServer et en .NET ne sont pas les mêmes, SQLServer étant le limitant, faites gaffes aux valeurs entrées
 * *Note2:* Si l'API est mise à jour mais que le wraper client n'as pas été mis en conformité, lancez le service WCF, placez vous dans le dossier du client (sous 7 shift+click sur le dossier, open in terminal) puis exécutez `.\Client>"c:\Program Files\Microsoft SDKs\Windows\v6.0A\Bin\SvcUtil.exe" http://localhost:1620/BusinessLayer.svc?wsdl`(en changeant le port si besoin)_